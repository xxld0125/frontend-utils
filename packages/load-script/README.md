# @frontendUtils/load-script

## ğŸš€ æ¦‚è¿°

`@frontendUtils/load-script` æ˜¯ä¸€ä¸ªåŸºäºæ²™ç®±éš”ç¦»æŠ€æœ¯çš„åŠ¨æ€ JavaScript è„šæœ¬åŠ è½½å™¨ï¼Œä¸“é—¨ç”¨äºå®‰å…¨åœ°åŠ è½½å’Œæ‰§è¡Œè¿œç¨‹ **UMD (Universal Module Definition)** æ ¼å¼çš„è„šæœ¬ã€‚å®ƒæä¾›äº†å¾®å‰ç«¯çº§åˆ«çš„è„šæœ¬éš”ç¦»èƒ½åŠ›ï¼Œç¡®ä¿è„šæœ¬æ‰§è¡Œä¸ä¼šæ±¡æŸ“å®¿ä¸»ç¯å¢ƒã€‚

## âœ¨ ç‰¹æ€§

- ğŸ›¡ï¸ **æ²™ç®±éš”ç¦»**ï¼šåŸºäº Proxy çš„å®Œæ•´æ²™ç®±æœºåˆ¶ï¼Œæä¾›å®‰å…¨çš„è„šæœ¬æ‰§è¡Œç¯å¢ƒ
- ğŸ”„ **UMDè„šæœ¬åŠ è½½**ï¼šä¸“é—¨æ”¯æŒUMDæ ¼å¼çš„è„šæœ¬åº“åŠ¨æ€åŠ è½½
- ğŸªŸ **ä»£ç†çª—å£**ï¼šåˆ›å»ºä»£ç† window å¯¹è±¡ï¼Œæ‹¦æˆªå’Œç®¡ç†å…¨å±€å˜é‡è®¿é—®
- ğŸ’¾ **æ™ºèƒ½ç¼“å­˜**ï¼šé¿å…é‡å¤åŠ è½½ç›¸åŒè„šæœ¬ï¼Œæå‡æ€§èƒ½
- ğŸŒ **HTTP è¯·æ±‚**ï¼šæä¾›ä¾¿æ·çš„ GET/POST æ•°æ®è¯·æ±‚åŠŸèƒ½
- ğŸ” **é”™è¯¯å¤„ç†**ï¼šå®Œå–„çš„é”™è¯¯æ•è·å’Œæç¤ºæœºåˆ¶
- ğŸ¯ **å‡½æ•°ç»‘å®š**ï¼šè‡ªåŠ¨å°†å‡½æ•°ç»‘å®šåˆ°æ­£ç¡®çš„æ‰§è¡Œä¸Šä¸‹æ–‡
- ğŸ”’ **å±æ€§éš”ç¦»**ï¼šæ”¯æŒå±æ€§é€ƒé€¸ç­–ç•¥ï¼Œçµæ´»æ§åˆ¶å…¨å±€å˜é‡çš„å¯è§æ€§

## ğŸ“¦ å®‰è£…

```bash
pnpm install @frontendUtils/load-script
```

## ğŸ¯ åŸºæœ¬ç”¨æ³•

### åœ¨æ²™ç®±ä¸­åŠ è½½UMDæ ¼å¼è„šæœ¬

```javascript
import { loadScript } from '@frontendUtils/load-script';

// åœ¨éš”ç¦»æ²™ç®±ä¸­åŠ è½½ Lodash (UMDæ ¼å¼)
const _ = await loadScript('https://unpkg.com/lodash@4.17.21/lodash.min.js');
console.log(_.chunk([1, 2, 3, 4, 5, 6], 2)); // [[1, 2], [3, 4], [5, 6]]
// æ³¨æ„ï¼šè„šæœ¬åœ¨æ²™ç®±ä¸­æ‰§è¡Œï¼Œä¸ä¼šæ±¡æŸ“å…¨å±€ window å¯¹è±¡

// åœ¨æ²™ç®±ä¸­åŠ è½½ Vue 3 (UMDæ ¼å¼)
const Vue = await loadScript('https://unpkg.com/vue@3/dist/vue.global.js');
const app = Vue.createApp({
  template: '<div>Hello from sandboxed Vue!</div>'
});

// åœ¨æ²™ç®±ä¸­åŠ è½½ Chart.js (UMDæ ¼å¼)
const Chart = await loadScript('https://unpkg.com/chart.js@4/dist/chart.umd.js');
const ctx = document.getElementById('myChart').getContext('2d');
new Chart(ctx, {
  type: 'bar',
  data: {
    /* æ•°æ® */
  },
  options: {
    /* é…ç½® */
  }
});
```

### HTTP è¯·æ±‚

```javascript
import { getData, getRemoteString, postData } from '@frontendUtils/load-script';

// GET è¯·æ±‚
const user = await getData('https://api.example.com/user/1');

// POST è¯·æ±‚
const result = await postData(
  'https://api.example.com/users',
  {
    name: 'John',
    email: 'john@example.com'
  },
  {
    Authorization: 'Bearer token'
  }
);

// è·å–è¿œç¨‹æ–‡æœ¬å†…å®¹
const content = await getRemoteString('https://example.com/data.txt');
```

### æ²™ç®±ç‰¹æ€§æ¼”ç¤º

```javascript
import { loadScript } from '@frontendUtils/load-script';

// åŠ è½½å¤šä¸ªåº“è€Œä¸ä¼šç›¸äº’å¹²æ‰°
const moment = await loadScript('https://unpkg.com/moment@2.29.4/moment.js');
const dayjs = await loadScript('https://unpkg.com/dayjs@1.11.10/dayjs.min.js');

// æ¯ä¸ªåº“éƒ½åœ¨ç‹¬ç«‹çš„æ²™ç®±ç¯å¢ƒä¸­è¿è¡Œ
console.log(moment().format('YYYY-MM-DD'));
console.log(dayjs().format('YYYY-MM-DD'));

// å…¨å±€ window å¯¹è±¡ä¿æŒæ¸…æ´ï¼Œä¸ä¼šè¢«æ±¡æŸ“
console.log(window.moment); // undefined
console.log(window.dayjs); // undefined
```

## âš ï¸ é‡è¦è¯´æ˜

### æ²™ç®±éš”ç¦»æœºåˆ¶

æœ¬å·¥å…·åº“é‡‡ç”¨**åŸºäº Proxy çš„æ²™ç®±éš”ç¦»æŠ€æœ¯**ï¼Œç¡®ä¿è„šæœ¬åœ¨å®‰å…¨çš„éš”ç¦»ç¯å¢ƒä¸­æ‰§è¡Œï¼š

- **éš”ç¦»æ‰§è¡Œ**ï¼šæ¯ä¸ªè„šæœ¬åœ¨ç‹¬ç«‹çš„ä»£ç†çª—å£ä¸­è¿è¡Œ
- **é˜²æ­¢æ±¡æŸ“**ï¼šè„šæœ¬æ‰§è¡Œä¸ä¼šå½±å“å®¿ä¸»åº”ç”¨çš„å…¨å±€å˜é‡
- **å®‰å…¨æ§åˆ¶**ï¼šå®Œæ•´çš„å±æ€§è®¿é—®æ‹¦æˆªå’Œç®¡ç†æœºåˆ¶
- **å‡½æ•°ç»‘å®š**ï¼šè‡ªåŠ¨å¤„ç†å‡½æ•°ä¸Šä¸‹æ–‡ç»‘å®šé—®é¢˜

### æ”¯æŒUMDæ ¼å¼

æœ¬å·¥å…·åº“**ä¸“é—¨æ”¯æŒUMD (Universal Module Definition)æ ¼å¼**çš„JavaScriptè„šæœ¬ã€‚UMDæ˜¯ä¸€ç§é€šç”¨æ¨¡å—å®šä¹‰æ ¼å¼ï¼Œèƒ½å¤ŸåŒæ—¶å…¼å®¹ï¼š

- CommonJS (Node.js)
- AMD (RequireJS)
- æµè§ˆå™¨å…¨å±€å˜é‡

### UMDè„šæœ¬åœ¨æ²™ç®±ä¸­çš„æ‰§è¡Œæµç¨‹

```javascript
// UMDè„šæœ¬æ¨¡å¼
(function (global, factory) {
  if (typeof exports === 'object' && typeof module !== 'undefined') {
    // CommonJS - åœ¨æ²™ç®±ä¸­ä¼šè¢«æ­£ç¡®å¤„ç†
    module.exports = factory();
  } else if (typeof define === 'function' && define.amd) {
    // AMD - åœ¨æ²™ç®±ä¸­ä¼šè¢«æ­£ç¡®å¤„ç†
    define([], factory);
  } else {
    // Browser globals - åœ¨ä»£ç†çª—å£ä¸­è®¾ç½®å…¨å±€å˜é‡
    global.LibraryName = factory();
  }
})(proxyWindow, function () {
  // åº“çš„å®ç°ä»£ç åœ¨æ²™ç®±ä¸­å®‰å…¨æ‰§è¡Œ
  return LibraryObject;
});
```

### æ¨èçš„UMDåº“

ä»¥ä¸‹æ˜¯ä¸€äº›æ”¯æŒUMDæ ¼å¼çš„æµè¡ŒJavaScriptåº“ï¼š

- **Lodash**: `https://unpkg.com/lodash@4.17.21/lodash.min.js`
- **Vue 3**: `https://unpkg.com/vue@3/dist/vue.global.js`
- **Chart.js**: `https://unpkg.com/chart.js@4/dist/chart.umd.js`
- **Day.js**: `https://unpkg.com/dayjs@1.11.10/dayjs.min.js`
- **Axios**: `https://unpkg.com/axios@1.6.2/dist/axios.min.js`

## ğŸ§ª æµ‹è¯•å’Œæ¼”ç¤º

### è¿è¡Œæµ‹è¯•

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd packages/load-script

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pnpm test

# è¿è¡Œæµ‹è¯•å¹¶æŸ¥çœ‹è¦†ç›–ç‡
pnpm test:coverage

# ç›‘å¬æ¨¡å¼è¿è¡Œæµ‹è¯•
pnpm test:watch
```

æµ‹è¯•æ¶µç›–å†…å®¹ï¼š

- ğŸ›¡ï¸ **æ²™ç®±éš”ç¦»æµ‹è¯•**ï¼šéªŒè¯è„šæœ¬éš”ç¦»æ‰§è¡Œæ•ˆæœ
- ğŸ”§ **UMDè„šæœ¬éªŒè¯**ï¼šè‡ªåŠ¨æ£€æµ‹å¹¶éªŒè¯åŠ è½½çš„UMDè„šæœ¬åŠŸèƒ½
- ğŸªŸ **ä»£ç†çª—å£æµ‹è¯•**ï¼šéªŒè¯ä»£ç†çª—å£çš„å±æ€§æ‹¦æˆªå’Œç®¡ç†
- ğŸ“Š **æ€§èƒ½ç›‘æ§**ï¼šæµ‹è¯•åŠ è½½æ—¶é—´å’Œç¼“å­˜æ•ˆæœ
- âŒ **é”™è¯¯å¤„ç†æµ‹è¯•**ï¼šéªŒè¯å„ç§é”™è¯¯åœºæ™¯çš„å¤„ç†
- ğŸ¯ **å‡½æ•°ç»‘å®šæµ‹è¯•**ï¼šéªŒè¯å‡½æ•°ä¸Šä¸‹æ–‡ç»‘å®šçš„æ­£ç¡®æ€§

## ğŸ“š æŠ€æœ¯æ–‡æ¡£

### é‡è¦æŠ€æœ¯å†³ç­–

- ğŸ“„ [eval vs new Function æŠ€æœ¯å¯¹æ¯”åˆ†æ](./docs/eval-vs-new-function.md)
- ğŸ“– [æ²™ç®±æ¶æ„è®¾è®¡æ–‡æ¡£](./docs/README.md)

### æ ¸å¿ƒæ¦‚å¿µ

- **æ²™ç®±éš”ç¦»**ï¼šåŸºäº Proxy çš„å®Œæ•´æ²™ç®±éš”ç¦»æœºåˆ¶
- **ä»£ç†çª—å£**ï¼šæ‹¦æˆªå’Œç®¡ç†æ‰€æœ‰ window å¯¹è±¡æ“ä½œ
- **å‡½æ•°ç»‘å®š**ï¼šè‡ªåŠ¨å¤„ç†å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡çš„ç»‘å®šé—®é¢˜
- **å±æ€§ç®¡ç†**ï¼šæ”¯æŒå±æ€§é€ƒé€¸ã€ä½œç”¨åŸŸæ§åˆ¶ç­‰é«˜çº§ç‰¹æ€§
- **UMD ä¼˜åŒ–**ï¼šä¸“é—¨ä¸ºUMDæ ¼å¼è„šæœ¬ä¼˜åŒ–çš„æ‰§è¡Œç¯å¢ƒ
- **ç¼“å­˜ç­–ç•¥**ï¼šåŸºäºURLçš„æ™ºèƒ½ç¼“å­˜æœºåˆ¶

## ğŸ”§ API å‚è€ƒ

### loadScript(url: string)

åœ¨æ²™ç®±ç¯å¢ƒä¸­åŠ¨æ€åŠ è½½è¿œç¨‹UMD JavaScriptè„šæœ¬ã€‚

**å‚æ•°ï¼š**

- `url` - UMDè„šæœ¬çš„è¿œç¨‹URL

**è¿”å›ï¼š** `Promise<any>` - UMDè„šæœ¬çš„å¯¼å‡ºå¯¹è±¡ï¼ˆä»æ²™ç®±ä¸­æå–ï¼‰

**ç‰¹æ€§ï¼š**

- è„šæœ¬åœ¨éš”ç¦»çš„æ²™ç®±ç¯å¢ƒä¸­æ‰§è¡Œ
- è‡ªåŠ¨ç¼“å­˜åŠ è½½ç»“æœï¼Œé¿å…é‡å¤è¯·æ±‚
- æ”¯æŒå®Œæ•´çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
- ä¸ä¼šæ±¡æŸ“å®¿ä¸»åº”ç”¨çš„å…¨å±€ç¯å¢ƒ

**æŠ›å‡ºï¼š** å¦‚æœè„šæœ¬åŠ è½½å¤±è´¥æˆ–æ‰§è¡Œå‡ºé”™ï¼Œä¼šæŠ›å‡ºè¯¦ç»†çš„é”™è¯¯ä¿¡æ¯

### getRemoteString(url: string)

è·å–è¿œç¨‹æ–‡æœ¬å†…å®¹ã€‚

**å‚æ•°ï¼š**

- `url` - èµ„æºçš„è¿œç¨‹URL

**è¿”å›ï¼š** `Promise<string>` - æ–‡æœ¬å†…å®¹

### getData<T>(url: string, headers?: Record<string, string>)

å‘é€ GET è¯·æ±‚ã€‚

**å‚æ•°ï¼š**

- `url` - è¯·æ±‚URL
- `headers` - å¯é€‰çš„è¯·æ±‚å¤´

**è¿”å›ï¼š** `Promise<T>` - å“åº”æ•°æ®

### postData<T>(url: string, data: Record<string, any>, headers?: Record<string, string>)

å‘é€ POST è¯·æ±‚ã€‚

**å‚æ•°ï¼š**

- `url` - è¯·æ±‚URL
- `data` - è¯·æ±‚æ•°æ®
- `headers` - å¯é€‰çš„è¯·æ±‚å¤´

**è¿”å›ï¼š** `Promise<T>` - å“åº”æ•°æ®

## ğŸ›¡ï¸ å®‰å…¨è€ƒè™‘

### æ²™ç®±å®‰å…¨ç‰¹æ€§

- âœ… **éš”ç¦»æ‰§è¡Œ**ï¼šè„šæœ¬åœ¨ç‹¬ç«‹æ²™ç®±ä¸­è¿è¡Œï¼Œæ— æ³•ç›´æ¥è®¿é—®å®¿ä¸»ç¯å¢ƒ
- âœ… **ä»£ç†æ‹¦æˆª**ï¼šæ‰€æœ‰ window å¯¹è±¡è®¿é—®éƒ½è¢«ä»£ç†æ‹¦æˆªå’Œç®¡ç†
- âœ… **å±æ€§éš”ç¦»**ï¼šé˜²æ­¢è„šæœ¬æ±¡æŸ“å®¿ä¸»åº”ç”¨çš„å…¨å±€å˜é‡
- âœ… **å‡½æ•°ç»‘å®šæ§åˆ¶**ï¼šè‡ªåŠ¨å¤„ç†å‡½æ•°ä¸Šä¸‹æ–‡ï¼Œé˜²æ­¢æ„å¤–çš„ä½œç”¨åŸŸæ³„éœ²

### åŸºç¡€å®‰å…¨å»ºè®®

- âœ… åªåŠ è½½æ˜ç¡®æŒ‡å®šçš„UMDæ ¼å¼è„šæœ¬
- âœ… å»ºè®®åªåŠ è½½æ¥è‡ªå¯ä¿¡æºçš„è„šæœ¬
- âœ… æ¨èä½¿ç”¨ HTTPS åè®®
- âœ… é…åˆ CSP (Content Security Policy) ä½¿ç”¨
- âœ… å®šæœŸå®¡æŸ¥åŠ è½½çš„è¿œç¨‹è„šæœ¬æº

### æ³¨æ„äº‹é¡¹

- âš ï¸ æ²™ç®±æä¾›éš”ç¦»ä½†ä¸èƒ½å®Œå…¨é˜»æ­¢æ¶æ„ä»£ç 
- âš ï¸ ä»éœ€è¦éªŒè¯è„šæœ¬æ¥æºçš„å¯ä¿¡åº¦
- âš ï¸ å»ºè®®åœ¨æµ‹è¯•ç¯å¢ƒä¸­å……åˆ†éªŒè¯è„šæœ¬è¡Œä¸º

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/amazing-feature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'feat: æ·»åŠ æŸä¸ªåŠŸèƒ½'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/amazing-feature`)
5. å¼€å¯ Pull Request

## ğŸ“„ è®¸å¯è¯

MIT License - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶

---

> ğŸ’¡ **æç¤º**ï¼šæŸ¥çœ‹ [æŠ€æœ¯æ–‡æ¡£](./docs/) äº†è§£æ²™ç®±éš”ç¦»æœºåˆ¶ã€UMDæ ¼å¼æ”¯æŒå’Œæœ€ä½³å®è·µã€‚ğŸ—ï¸ **æ¶æ„è¯´æ˜**ï¼šæœ¬å·¥å…·åŸºäºå¾®å‰ç«¯æ²™ç®±æŠ€æœ¯æ„å»ºï¼Œæä¾›ä¼ä¸šçº§çš„è„šæœ¬éš”ç¦»èƒ½åŠ›ã€‚
